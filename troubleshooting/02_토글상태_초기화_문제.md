# 토글 상태 초기화 문제

## 문제 상황
하위 항목의 토글을 접었는데, 상위 항목을 접었다가 다시 펼치면 하위 항목이 **초기값(펼침)으로 돌아가는** 문제가 발생했습니다.

## 원인 분석
상위 항목이 접히면 하위 컴포넌트가 DOM에서 제거되고, 다시 펼칠 때 새로 렌더링되면서 각 항목의 `isExpanded` 상태가 초기값으로 리셋되었습니다.

```typescript
// 문제가 발생한 구조
{todo.isExpanded && (
    <TodoList todos={todo.children} />  // 부모가 접히면 제거됨
)}
```

부모가 접히면(`isExpanded: false`) 자식 컴포넌트가 완전히 제거되고, 다시 펼칠 때 새로 마운트되면서 모든 state가 초기화됩니다.

## 시도한 방법
```typescript
// ❌ 로컬 state로 관리 (컴포넌트 제거 시 사라짐)
function TodoItem({ todo }) {
    const [isExpanded, setIsExpanded] = useState(true);
    // 컴포넌트가 제거되면 이 state도 사라짐
}
```

## 해결 방법
각 Todo 항목의 데이터 구조에 `isExpanded` 필드를 추가하여 **전역 상태로 관리**했습니다.

```typescript
// ✅ 데이터 모델에 포함
interface Todo {
    id: string;
    text: string;
    completed: boolean;
    isExpanded: boolean;  // 펼침/접힘 상태를 데이터로 관리
    children: Todo[];
}
```

## 구현 코드

### 1. 토글 함수 추가
```typescript
function toggleExpand(id: string) {
    setTodos(getToggleExpand(todos, id));
}
```

### 2. 재귀 함수로 업데이트
```typescript
export function getToggleExpand(todoArray: Todo[], targetId: string): Todo[] {
    return todoArray.map(todo => {
        if (todo.id === targetId) {
            return { ...todo, isExpanded: !todo.isExpanded };
        }
        if (todo.children && todo.children.length > 0) {
            return { ...todo, children: getToggleExpand(todo.children, targetId) };
        }
        return todo;
    });
}
```

### 3. 조건부 렌더링
```typescript
{todo.children.length > 0 && todo.isExpanded && (
    <div className="todo-children">
        <TodoList todos={todo.children} />
    </div>
)}
```

